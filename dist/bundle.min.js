const defaults={timeoutMs:6e5};function SendXhrData(e){return new Promise(((o,t)=>{const n=new XMLHttpRequest,r=()=>{t(new Error("TimeoutError"))};n.open(e.method,e.url),e.reqHeaders&&e.reqHeaders.forEach((e=>{""!==e.header&&""!==e.value&&(console.log(`Setting custom request header '${e.header}, ${e.value}'`),n.setRequestHeader(e.header,e.value))})),n.timeout=e.timeoutMs?e.timeoutMs:defaults.timeoutMs,n.responseType=e.respType,n.addEventListener("load",(r=>{console.log("HandleLoad"),n.status>=200&&n.status<300?(o(n.response),e.consoleInfo&&console.group(e.consoleInfo),console.log(`${r.loaded} bytes loaded.`),e.consoleInfo&&console.groupEnd()):t(new Error(`HTML status code ${n.status}`))})),n.addEventListener("error",(o=>{t(new Error("jXhr: failed to send request!")),e.consoleInfo&&console.group(e.consoleInfo),console.log(o),console.error(`xhr.status ${n.status}`),e.consoleInfo&&console.groupEnd()})),n.addEventListener("progress",(o=>{if(o.lengthComputable){const t=o.loaded/o.total*100;e.progress&&e.progress(t,o.loaded)}else e.progress&&e.progress(-1,o.loaded)})),e.loadend&&n.addEventListener("loadend",e.loadend),e.abort&&n.addEventListener("abort",e.abort),e.readystatechange&&n.addEventListener("readystatechange",e.readystatechange),e.timeout?n.addEventListener("timeout",e.timeout):n.addEventListener("timeout",r),n.send(e.data),e.xhrReference&&e.xhrReference(n)}))}const startButton=document.querySelector("#startButton"),abortButton=document.querySelector("#abortButton"),loadProgress=document.querySelector("#loadProgress"),loadBytes=document.querySelector("#loadBytes");let pointerToXhr=null;async function TryToSendData(){let e;const o={method:"get",url:"https://api.covidtracking.com/v1/states/daily.json",data:"my test",respType:"json",reqHeaders:[],timeoutMs:2e3,loadend:OnLoadEnd,progress:OnProgress,abort:OnAbort,xhrReference:ObtainXhrReference,consoleInfo:"Connecting..."};try{e=await SendXhrData(o),e&&200===e.status?console.log("JSON response with 200, good! JSON below."):console.log("HTML response OK, but JSON response.status not 200. JSON below.")}catch(e){console.log(`An error occured, but we handled it. Error message: ${e.message}`)}}function OnProgress(e,o){loadProgress&&(loadProgress.value=e),loadBytes&&(loadBytes.innerText=o+" bytes")}function OnAbort(){console.log("OnAbort called!")}function OnLoadEnd(){console.log("OnLoadEnd called!")}function OnStartButtonClick(){console.log("start OnStartButtonClick"),TryToSendData(),console.log("end OnStartButtonClick")}function ObtainXhrReference(e){pointerToXhr=e}function OnAbortButtonClick(){console.log("start OnAbortButtonClick"),pointerToXhr&&pointerToXhr.abort(),console.log("end OnAbortButtonClick")}startButton&&startButton.addEventListener("click",OnStartButtonClick),abortButton&&abortButton.addEventListener("click",OnAbortButtonClick);